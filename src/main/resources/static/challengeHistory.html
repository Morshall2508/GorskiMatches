<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="bigiPadForChallengeHistory">
    <div class="navigationBar">
        <div id="homeButton">Home</div>
        <div id="accountPage">Account</div>
    </div>
    <div id="indexPadForChallengeHistory">
        <div id="tableUuidTime"></div>
    </div>
</div>
</body>
<script type="module">
    import Auth from "/auth.js";
    fetch(`/api/challenge/challenges`)

        .then(res => {
            if (res.ok) {
                return res.json()
            }
            {
                throw "Not found";
            }
        })
        .then(json => {
            let html = "";
            html += `<div class = "topBarFirst"> Date and Time</div>
                <div class = "topBarSecond"> Result </div>`

            json.forEach(item => {
                var date = (new Date(item.creationTime).toLocaleString())

                let uuid = item.uuid;
                let result = item.registeredUserScore > item.nonRegisteredUserScore;

                let totalResultUser1 = 0;
                let totalResultUser2 = 0;
                let i;
                for (i = 0; i < 5; i++) {
                    if (item.challengeQuizzes[i].scoreUser1 > 0) {
                        totalResultUser1++;
                    }
                    if (item.challengeQuizzes[i].scoreUser2 > 0) {
                        totalResultUser2++;
                    }
                }
                if (item.emailUser1 === Auth.getEmail() || item.emailUser2 === Auth.getEmail()) {

                    if (Auth.getEmail() == item.emailUser1) {

                        // Case Registered_01 vs Non Registered
                        if (item.emailUser2 == null) {

                            if (item.timeToSolveUser2 === 0 || item.timeToSolveUser1 === 0) {

                                html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');"> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');"></div>`
                            } else {
                                let totalTime = Boolean(item.timeToSolveUser2 > item.timeToSolveUser1);
                                if (item.registeredUserScore === item.nonRegisteredUserScore) {
                                    html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${totalTime ? "#54af54" : "#d54545"}> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${totalTime ? "#54af54" : "#d54545"}> ${totalTime ? "Won" : "Lost"}</div>`
                                    document.getElementById("tableUuidTime").innerHTML = html;
                                } else {
                                    html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${result ? "#54af54" : "#d54545"}> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${result ? "#54af54" : "#d54545"}> ${result ? "Won" : "Lost"}</div>`
                                    document.getElementById("tableUuidTime").innerHTML = html;
                                }
                            }
                        }
                        // Case Registered vs registered - Registered 01 view
                        else {
                            if (item.timeToSolveUser1 === 0 || item.timeToSolveUser2 === 0) {

                                html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');"> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');"></div>`
                            } else {

                                if (totalResultUser1 === totalResultUser2) {

                                    let totalTime = Boolean(item.timeToSolveUser2 > item.timeToSolveUser1);
                                    html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${totalTime ? "#54af54" : "#d54545"}> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${totalTime ? "#54af54" : "#d54545"}> ${totalTime ? "Won" : "Lost"}</div>`
                                    document.getElementById("tableUuidTime").innerHTML = html;
                                } else {

                                    let resultforBothRegistered = Boolean(totalResultUser1 > totalResultUser2);
                                    html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${resultforBothRegistered ? "#54af54" : "#d54545"}> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${resultforBothRegistered ? "#54af54" : "#d54545"}> ${resultforBothRegistered ? "Won" : "Lost"}</div>`
                                    document.getElementById("tableUuidTime").innerHTML = html;
                                }
                            }
                        }

                        document.getElementById("tableUuidTime").innerHTML = html;

                    } else {
                        // Case Registered vs registered - Registered 02 view
                        if (item.timeToSolveUser1 === 0 || item.timeToSolveUser2 === 0) {

                            html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');"> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');"></div>`
                        } else {

                            if (totalResultUser1 === totalResultUser2) {

                                let totalTime = Boolean(item.timeToSolveUser1 > item.timeToSolveUser2);
                                html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${totalTime ? "#54af54" : "#d54545"}> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${totalTime ? "#54af54" : "#d54545"}> ${totalTime ? "Won" : "Lost"}</div>`
                                document.getElementById("tableUuidTime").innerHTML = html;
                            } else {
                                let resultforBothRegistered = Boolean(totalResultUser2 > totalResultUser1);
                                html += `
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${resultforBothRegistered ? "#54af54" : "#d54545"}> ${new Date(item.creationTime).toLocaleString()}</div>
                <div class = "challengeHistoryElement" onclick="window.location.href='/challengeDetails.html?uuid=' + ('${uuid}');" style = background-color:${resultforBothRegistered ? "#54af54" : "#d54545"}> ${resultforBothRegistered ? "Won" : "Lost"}</div>`
                                document.getElementById("tableUuidTime").innerHTML = html;
                            }
                        }
                    }
                }
            })

        })
</script>
<script>
    document.getElementById("accountPage").onclick = () => {
        window.location.replace("/account.html?")
    };
</script>
<script>
    document.getElementById("homeButton").onclick = () => {
        window.location.replace("/")
    };
</script>

</html>