<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="bigiPadForChallengeHistory">
    <div class="navigationBar">
        <div id="homeButton">Home</div>
        <div id="accountPage">Account</div>
    </div>
    <div id="indexPadForChallengeHistory">
        <div id="table"></div>
        <i class="arrow left" onclick="window.location.href='/challengeHistory.html?';"></i>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const uuid = urlParams.get('uuid');
    sessionStorage.setItem('uuid', uuid);


    fetch(`/api/challenge/${uuid}`)
        .then(res => {
            if (res.ok) {
                return res.json()
            }
            {
                throw "Not found";
            }
        })

        .then(json => {
            let html = "";
            let timeUser2 = (json.nonRegisteredUserTimeSeconds / 1000).toFixed(2);
            let timeUser1 = (json.registeredUserTimeSeconds / 1000).toFixed(2);
            let totalScoreRegister = json.registeredUserScore;
            let totalScoreNonRegister = json.nonRegisteredUserScore;

            document.getElementById("table").style.gap = "2px";
            html += `
                <div class = "sidebarElement"> Quiz</div>
                <div class = "sidebarElement"> Your Answer</div>
                <div class = "sidebarElement"> Opponent Answer</div>
                <div class = "sidebarElement"> Your Time </div>
                <div class = "sidebarElement"> Opponent Time </div>`

            json.challengeQuizzes.forEach(innerItem => {

                let resultUser1 = Boolean(innerItem.scoreUser1 > 0);
                let resultUser2 = Boolean(innerItem.scoreUser2 > 0);
                if (json.nonRegisteredUserTimeSeconds === 0 || json.registeredUserTimeSeconds === 0) {
                    html += `<div class = "tableElement">${innerItem.quiz}</div>
                        <div class = "tableElement"> ${innerItem.answerUser1}</div>
                        <div class = "tableElement"> ${innerItem.answerUser2}</div>
                        </div>`
                } else {
                    html += `<div class = "tableElement">${innerItem.quiz}</div>
                        <div class = "tableElement" style = background-color:${resultUser2 ? "#54af54" : "#d54545"}> ${innerItem.answerUser1}</div>
                        <div class = "tableElement" style = background-color:${resultUser1 ? "#54af54" : "#d54545"}> ${innerItem.answerUser2}</div>
                        </div>`
                }
            })
            if (json.nonRegisteredUserTimeSeconds === 0 || json.registeredUserTimeSeconds === 0) {
                html += `<div class = "tableTime">${timeUser1}s</div>
                         <div class = "tableTime">${timeUser2}s</div>`
            } else {
                if (totalScoreNonRegister === totalScoreRegister) {
                    let totalResult = Boolean(timeUser1 > timeUser2);
                    html += `<div class = "tableTime" style = background-color:${totalResult ? "#d54545" : "#54af54"}>${timeUser1}s</div>
                         <div class = "tableTime" style = background-color:${totalResult ? "#54af54" : "#d54545"}>${timeUser2}s</div>`
                    document.getElementById("table").innerHTML = html;
                } else {
                    html += `<div class = "tableTime">${timeUser1}s</div>
                         <div class = "tableTime">${timeUser2}s</div>`
                    document.getElementById("table").innerHTML = html;
                }
            }
            document.getElementById("table").innerHTML = html;
        })

</script>
<script>
    document.getElementById("accountPage").onclick = () => {
        window.location.replace("/account.html?")
    };
</script>
<script>
    document.getElementById("homeButton").onclick = () => {
        window.location.replace("/")
    };
</script>
</body>
</html>